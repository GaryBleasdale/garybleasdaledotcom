---
import CommitHeatmap from "@/components/react/CommitHeatmap";
import Layout from "@/layouts/Layout.astro";
import { db, commits, sql } from "astro:db";
import { basics } from "@cv";
const { name } = basics;
import "../styles/calHeatmap.css";

const yearResult = await db
  .selectDistinct({
    year: sql<number>`CAST(strftime('%Y', ${commits.commit_timestamp}, 'unixepoch') AS INTEGER)`,
  })
  .from(commits)
  .orderBy(sql`${commits.commit_timestamp} DESC`);

const availableYears = yearResult.map((row) => row.year);

const initialYear =
  availableYears.length > 0 ? availableYears[0] : new Date().getFullYear();
---

<Layout title=`${name}: Git`>
  <div
    style={{
      background: "#22272d",
      color: "#adbac7",
      borderRadius: "3px",
      padding: "1rem",
      overflow: "hidden",
    }}
  >
    <div>Heatmaps</div>
    <CommitHeatmap
      client:load
      availableYears={availableYears}
      initialYear={initialYear}
    />
    <div style={{ float: "right", fontSize: 12 }}>
      <span style={{ color: "#768390" }}>Less</span>
      <div
        id="ex-ghDay-legend"
        style={{ display: "inline-block", margin: "0 4px" }}
      >
      </div>
      <span style={{ color: "#768390", fontSize: 12 }}>More</span>
    </div>
  </div>
</Layout>
